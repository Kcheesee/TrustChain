# TrustChain Architecture Diagram

## System Flow Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER / APPLICATION                              â”‚
â”‚                    (Government Case Worker, API Client)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTP POST /api/v1/decisions
                                  â”‚ {case_id, input_data, policy_context}
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            FASTAPI REST API                                  â”‚
â”‚                         (app.py - Port 8000)                                 â”‚
â”‚                                                                              â”‚
â”‚  Endpoints:                                                                  â”‚
â”‚  â€¢ POST   /api/v1/decisions      â†’ Submit new decision                      â”‚
â”‚  â€¢ GET    /api/v1/decisions/{id} â†’ Retrieve decision                        â”‚
â”‚  â€¢ GET    /api/v1/health         â†’ System health check                      â”‚
â”‚  â€¢ GET    /api/v1/providers      â†’ AI provider status                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Creates Decision object
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DECISION ORCHESTRATOR                                  â”‚
â”‚                   (services/orchestrator.py)                                 â”‚
â”‚                                                                              â”‚
â”‚  Responsibilities:                                                           â”‚
â”‚  âœ“ Coordinate multiple AI models                                            â”‚
â”‚  âœ“ Execute queries in parallel (asyncio.gather)                             â”‚
â”‚  âœ“ Parse and standardize responses                                          â”‚
â”‚  âœ“ Calculate consensus metrics                                              â”‚
â”‚  âœ“ Trigger bias detection                                                   â”‚
â”‚  âœ“ Generate audit hash (SHA-256)                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚          â”‚          â”‚
           â”‚          â”‚          â”‚ Parallel Execution (2-4 seconds total)
           â”‚          â”‚          â”‚
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
      â”‚Providerâ”‚ â”‚Providerâ”‚ â”‚Providerâ”‚
      â”‚   1    â”‚ â”‚   2    â”‚ â”‚   3    â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
           â”‚          â”‚          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AI PROVIDER LAYER                                    â”‚
â”‚                     (providers/base.py + implementations)                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ANTHROPIC (Claude)â”‚  â”‚   OPENAI (GPT-4)   â”‚  â”‚   LLAMA (Ollama)    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ Claude Opus      â”‚  â”‚ â€¢ GPT-4o           â”‚  â”‚ â€¢ Llama 2 (7B/13B)  â”‚   â”‚
â”‚  â”‚ â€¢ Claude Sonnet    â”‚  â”‚ â€¢ GPT-4 Turbo      â”‚  â”‚ â€¢ Llama 3 (8B/70B)  â”‚   â”‚
â”‚  â”‚ â€¢ Claude Haiku âœ“   â”‚  â”‚ â€¢ GPT-3.5 Turbo    â”‚  â”‚ â€¢ Local inference   â”‚   â”‚
â”‚  â”‚                    â”‚  â”‚                    â”‚  â”‚ â€¢ No API required   â”‚   â”‚
â”‚  â”‚ Features:          â”‚  â”‚ Features:          â”‚  â”‚ Features:           â”‚   â”‚
â”‚  â”‚ â€¢ Auto-retry (3x)  â”‚  â”‚ â€¢ Auto-retry (3x)  â”‚  â”‚ â€¢ Auto-retry (1x)   â”‚   â”‚
â”‚  â”‚ â€¢ Timeout: 60s     â”‚  â”‚ â€¢ Timeout: 60s     â”‚  â”‚ â€¢ Timeout: 90s      â”‚   â”‚
â”‚  â”‚ â€¢ Health tracking  â”‚  â”‚ â€¢ Health tracking  â”‚  â”‚ â€¢ Health tracking   â”‚   â”‚
â”‚  â”‚ â€¢ Token counting   â”‚  â”‚ â€¢ Token counting   â”‚  â”‚ â€¢ Token counting    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                       â”‚                         â”‚              â”‚
â”‚           â”‚  External API         â”‚  External API          â”‚  Local       â”‚
â”‚           â–¼                       â–¼                         â–¼              â”‚
â”‚  api.anthropic.com     api.openai.com             localhost:11434         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                       â”‚                         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ Returns: List[LLMResponse]
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RESPONSE PROCESSING                                     â”‚
â”‚                   (orchestrator._convert_to_model_decisions)                â”‚
â”‚                                                                              â”‚
â”‚  For each LLMResponse:                                                       â”‚
â”‚  1. Parse decision outcome (APPROVE/DENY/NEEDS_REVIEW)                      â”‚
â”‚  2. Extract reasoning text                                                   â”‚
â”‚  3. Calculate confidence score                                               â”‚
â”‚  4. Create ModelDecision object                                              â”‚
â”‚                                                                              â”‚
â”‚  Keyword Matching Algorithm:                                                 â”‚
â”‚  â€¢ approval_keywords: ["approve", "eligible", "qualify", ...]               â”‚
â”‚  â€¢ denial_keywords: ["deny", "reject", "ineligible", ...]                   â”‚
â”‚  â€¢ review_keywords: ["unclear", "uncertain", "needs review", ...]           â”‚
â”‚  â†’ Count matches â†’ Determine final decision                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ List[ModelDecision]
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CONSENSUS ANALYSIS                                   â”‚
â”‚                   (orchestrator._analyze_consensus)                          â”‚
â”‚                                                                              â”‚
â”‚  Metrics Calculated:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. AGREEMENT LEVEL                                                  â”‚   â”‚
â”‚  â”‚    = (# models agreeing with majority) / (total models)             â”‚   â”‚
â”‚  â”‚    Example: 2 out of 3 say APPROVE â†’ 66% agreement                 â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 2. MAJORITY DECISION                                                â”‚   â”‚
â”‚  â”‚    = Decision with most votes                                       â”‚   â”‚
â”‚  â”‚    Example: APPROVE(2), DENY(1) â†’ Majority: APPROVE                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 3. CONFIDENCE VARIANCE                                              â”‚   â”‚
â”‚  â”‚    = How much confidence scores vary                                â”‚   â”‚
â”‚  â”‚    Low variance = models similarly confident                        â”‚   â”‚
â”‚  â”‚    High variance = models uncertain                                 â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 4. DISSENTING MODELS                                                â”‚   â”‚
â”‚  â”‚    = List of models that disagreed with majority                    â”‚   â”‚
â”‚  â”‚    Example: ["llama"] if Claude & GPT agree but Llama disagrees     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Output: ConsensusAnalysis object                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ›¡ï¸ BIAS DETECTION & SAFETY ğŸ›¡ï¸                            â”‚
â”‚                   (services/bias_detection.py)                               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    LAYER 1: Protected Attributes                   â”‚    â”‚
â”‚  â”‚  Scans reasoning for mentions of:                                  â”‚    â”‚
â”‚  â”‚  â€¢ Race/Ethnicity    â€¢ Age           â€¢ Gender                      â”‚    â”‚
â”‚  â”‚  â€¢ Religion          â€¢ Disability    â€¢ Sexual Orientation          â”‚    â”‚
â”‚  â”‚  â€¢ National Origin   â€¢ Pregnancy     â€¢ Veteran Status              â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  Action: ANY mention â†’ ğŸš¨ MANDATORY HUMAN REVIEW                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    LAYER 2: Confidence Threshold                   â”‚    â”‚
â”‚  â”‚  Checks: Average confidence across all models                      â”‚    â”‚
â”‚  â”‚  Threshold: 70% (configurable)                                     â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  If avg_confidence < 0.7:                                          â”‚    â”‚
â”‚  â”‚    â†’ âš ï¸  Flag for review (models uncertain)                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    LAYER 3: Consensus Quality                      â”‚    â”‚
â”‚  â”‚  Analyzes:                                                          â”‚    â”‚
â”‚  â”‚  â€¢ Agreement level (% of models agreeing)                          â”‚    â”‚
â”‚  â”‚  â€¢ Confidence variance (how much scores vary)                      â”‚    â”‚
â”‚  â”‚  â€¢ Reasoning divergence (same decision, different reasons?)        â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  High variance despite consensus â†’ âš ï¸  Flag for review             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    LAYER 4: Decision Type Classification           â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  ğŸ”´ CRITICAL (Always Human Review):                                â”‚    â”‚
â”‚  â”‚     â€¢ immigration_deportation                                      â”‚    â”‚
â”‚  â”‚     â€¢ asylum_decision                                              â”‚    â”‚
â”‚  â”‚     â€¢ benefit_termination                                          â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  ğŸŸ¡ HIGH-STAKES (Strict Thresholds):                              â”‚    â”‚
â”‚  â”‚     â€¢ unemployment_benefits                                        â”‚    â”‚
â”‚  â”‚     â€¢ loan_approval                                                â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  ğŸŸ¢ LOW-STAKES (Can Auto-Decide):                                 â”‚    â”‚
â”‚  â”‚     â€¢ form_validation                                              â”‚    â”‚
â”‚  â”‚     â€¢ email_reminder                                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    LAYER 5: Mandatory Review Triggers              â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  Hard stops (bypass all other logic):                              â”‚    â”‚
â”‚  â”‚  âœ“ Protected attribute detected                                    â”‚    â”‚
â”‚  â”‚  âœ“ Life-altering decision type                                     â”‚    â”‚
â”‚  â”‚  âœ“ Very low consensus (<50%)                                       â”‚    â”‚
â”‚  â”‚  âœ“ Low consensus + bias detected                                   â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â†’ ğŸš¨ MANDATORY HUMAN REVIEW (no exceptions)                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  Output: BiasDetection object + requires_mandatory_review flag               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FINAL DECISION ASSEMBLY                               â”‚
â”‚                                                                              â”‚
â”‚  Decision object contains:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ â€¢ decision_id: "dec_20250115_103045_unemp_001"             â”‚            â”‚
â”‚  â”‚ â€¢ case_id: "unemp_001"                                     â”‚            â”‚
â”‚  â”‚ â€¢ final_decision: APPROVED | DENIED | NEEDS_REVIEW        â”‚            â”‚
â”‚  â”‚ â€¢ status: COMPLETED | REQUIRES_REVIEW                      â”‚            â”‚
â”‚  â”‚ â€¢ model_decisions: [Claude, GPT, Llama responses]          â”‚            â”‚
â”‚  â”‚ â€¢ consensus_analysis: {agreement, variance, dissenting}    â”‚            â”‚
â”‚  â”‚ â€¢ bias_analysis: {detected, type, attributes, recommendation}â”‚         â”‚
â”‚  â”‚ â€¢ audit_hash: SHA-256 hash for tamper detection            â”‚            â”‚
â”‚  â”‚ â€¢ created_at, completed_at: Timestamps                     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  Status Logic:                                                               â”‚
â”‚  if mandatory_review_required:                                               â”‚
â”‚      status = REQUIRES_REVIEW (ğŸš¨ Critical)                                 â”‚
â”‚  elif consensus < threshold (66%):                                           â”‚
â”‚      status = REQUIRES_REVIEW (âš ï¸  Low agreement)                           â”‚
â”‚  else:                                                                       â”‚
â”‚      status = COMPLETED (âœ… Safe to auto-decide)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AUDIT HASH GENERATION                                â”‚
â”‚                       (decision.calculate_audit_hash)                        â”‚
â”‚                                                                              â”‚
â”‚  Creates SHA-256 hash of:                                                    â”‚
â”‚  {                                                                           â”‚
â”‚    decision_id,                                                              â”‚
â”‚    case_id,                                                                  â”‚
â”‚    input_data,                                                               â”‚
â”‚    model_decisions: [provider, decision, reasoning, confidence],            â”‚
â”‚    final_decision,                                                           â”‚
â”‚    timestamp                                                                 â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  Result: "a1b2c3d4e5f6789..." (64-character hex string)                     â”‚
â”‚                                                                              â”‚
â”‚  Purpose:                                                                    â”‚
â”‚  âœ“ FOIA compliance - Tamper detection                                       â”‚
â”‚  âœ“ Legal defensibility - Proof decision wasn't altered                      â”‚
â”‚  âœ“ Chain of custody - Audit trail integrity                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            STORAGE LAYER                                     â”‚
â”‚                                                                              â”‚
â”‚  Current: In-memory dictionary (decision_store)                              â”‚
â”‚  Production: PostgreSQL database                                             â”‚
â”‚                                                                              â”‚
â”‚  Tables (planned):                                                           â”‚
â”‚  â€¢ decisions                                                                 â”‚
â”‚  â€¢ model_decisions                                                           â”‚
â”‚  â€¢ consensus_analysis                                                        â”‚
â”‚  â€¢ bias_detections                                                           â”‚
â”‚  â€¢ audit_logs                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Returns Decision object
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            RESPONSE TO USER                                  â”‚
â”‚                                                                              â”‚
â”‚  DecisionResponse {                                                          â”‚
â”‚    decision_id: "dec_...",                                                   â”‚
â”‚    status: "completed" | "requires_review",                                  â”‚
â”‚    final_decision: "approved" | "denied" | "needs_human_review",            â”‚
â”‚    consensus_analysis: {...},                                                â”‚
â”‚    model_decisions: [{provider, decision, reasoning, confidence}, ...],     â”‚
â”‚    requires_human_review: true | false,                                      â”‚
â”‚    audit_hash: "a1b2c3d4..."                                                 â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  If requires_human_review:                                                   â”‚
â”‚    â†’ Route to human reviewer queue                                           â”‚
â”‚    â†’ Display full reasoning from all models                                  â”‚
â”‚    â†’ Show bias detection flags                                               â”‚
â”‚  Else:                                                                       â”‚
â”‚    â†’ Auto-approve/deny                                                       â”‚
â”‚    â†’ Notify applicant                                                        â”‚
â”‚    â†’ Log decision                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Design Principles

1. **Parallel by Default**: All AI models query simultaneously (3x speedup)
2. **Fail Gracefully**: System works with 1/3 providers if others fail
3. **Safety First**: Multiple layers actively look for reasons to involve humans
4. **Audit Everything**: SHA-256 hashing ensures decisions can't be altered
5. **Transparent**: Full reasoning from every model available for review

## Performance Characteristics

- **Latency**: 2-4 seconds (parallel) vs 6-9 seconds (sequential)
- **Throughput**: Limited by AI provider rate limits
- **Reliability**: Continues with degraded providers
- **Scalability**: Stateless, horizontal scaling ready

## Security & Compliance

- âœ… API keys in environment variables (never committed)
- âœ… SHA-256 audit hashing (tamper detection)
- âœ… FOIA-compliant public reports (PII stripped)
- âœ… 7-year retention configuration
- âœ… Protected attribute detection
- âœ… Mandatory review for high-stakes decisions
